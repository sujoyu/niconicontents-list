<html lang="ja">
	<head>
		<script>
			document.addEventListener('DOMContentLoaded', function() {

			const form = document.getElementById('form')
			const textarea = document.getElementById('textarea')
			const list = document.getElementById('list')

			form.addEventListener('submit', function(ev) {
				list.innerHTML = ""

				ev.preventDefault()
				const ids = textarea.value.split('\n')
				ids.forEach(function(id) {
					const div = document.createElement('div')
					list.appendChild(div)

					var r = new XMLHttpRequest()
					r.open('GET', '/api/' + id, true)
					r.onreadystatechange = function() {
						const code = resp.querySelector('error code')
						if (r.readyState != 4 || r.status != 200
							|| code) {
							const h4 = document.createElement('h4')
							h4.textContent = id + ' が取得できませんでした。エラーコード(' + code + ')'
							return
						}
						const resp = r.responseXML
						const h4 = document.createElement('h4')
						h4.textContent = id + '. ' +  resp.querySelector('title').textContent
						const img = document.createElement('img')
						img.setAttribute('src', resp.querySelector('thumbnail_url').textContent)
						const p = document.createElement('p')
						p.textContent = resp.querySelector('description').textContent

						div.appendChild(h4)
						div.appendChild(img)
						div.appendChild(p)
					}
					r.send();
				})
			})
		})
		</script>
	</head>
	<body>
		<h3>動画情報取得したくない？</h3>
		<form id="form">
			動画ID(ex. sm9)のリスト
			<textarea id="textarea"></textarea>
			<button>検索</button>
		</form>
		<section id="list"></section>
	</body>
</html>